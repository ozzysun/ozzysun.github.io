(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{2796:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return o}));const a=t=>({id:t.id,product:t,qty:1,taste:{},toppings:[],capacity:""}),s=(t,e)=>{let n=null;return t.forEach((t=>{t.id===e.id&&(n=t)})),n},i=t=>t.add&&t.add>0?`${t.name}(+${t.add})`:t.name,r=(t,e,n)=>{let a=null;return t.taste.forEach((t=>{t.id===e&&t.items.forEach((t=>{t.id===n&&(a=t)}))})),null!==a?i(a):""},o=(t,e,n,a)=>{let i=!1;const r=s(t,e);return null!==r&&null!==r&&r[n]&&-1!==r[n].indexOf(a)&&(i=!0),i}},a3a5:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"e",(function(){return r})),n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return c}));var a=n("2796");const s=t=>{const e=[];for(const n in t.taste)t.product.taste.forEach((s=>{s.id===n&&e.push(`${s.name}(${Object(a["d"])(t.product,n,t.taste[n])})`)}));return t.toppings.length>0&&t.toppings.forEach((n=>{t.product.toppings.forEach((t=>{t.id===n&&e.push(t.name)}))})),""!==t.capacity&&t.product.capacity.forEach((n=>{n.id===t.capacity&&e.push(n.name)})),e.join(",")},i=t=>{let e=t.product.price;for(const n in t.taste){const a=t.taste[n];t.product.taste.forEach((t=>{t.id===n&&t.items.forEach((t=>{t.id===a&&void 0!==t.add&&t.add>0&&(e+=t.add)}))}))}return t.toppings.length>0&&t.toppings.forEach((n=>{t.product.toppings.forEach((t=>{t.id===n&&void 0!==t.add&&(e+=t.add)}))})),""!==t.capacity&&t.product.capacity.forEach((n=>{n.id===t.capacity&&void 0!==n.add&&(e+=n.add)})),e*t.qty},r=t=>{let e=0,n=0;return t.forEach((t=>{e+=i(t),n+=t.qty})),{totalPrice:e,count:t.length,itemsCount:n}},o=(t,e)=>{let n=null,a=null;return t.forEach((t=>{void 0!==e&&t.id===e&&(n=t),t.default&&(a=t)})),null===n&&null!==a&&(n=a),n},c=(t,e)=>{let n=null,a=null;return t.forEach((t=>{void 0!==e&&t.id===e&&(n=t),t.default&&(a=t)})),null===n&&null!==a&&(n=a),n}},a615:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[0===t.orders.length?n("div",{staticClass:"row"},[n("h6",[t._v("無訂單資料")])]):n("q-list",{staticClass:"q-gutter-sm",staticStyle:{width:"100%"},attrs:{bordered:"",separator:""}},[t._l(t.orders,(function(t){return n("history-item",{key:t.orderId,attrs:{item:t}})})),n("q-item",[n("q-space"),n("q-space")],1)],2),n("q-page-sticky",{attrs:{position:"bottom-right",offset:[20,10]}},[t.orders.length>0?n("clean-btn"):t._e()],1)],1)},s=[],i=n("ded3"),r=n.n(i),o=(n("e6cf"),n("efea")),c=n("2f62"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-expansion-item",{attrs:{"header-class":"bg-white text-black","dense-toggle":!0},scopedSlots:t._u([{key:"header",fn:function(){return[null!==t.info?n("q-item-section",{attrs:{avatar:""}},[n("q-item-label",{attrs:{caption:""}},[n("span",{class:"text-"+t.theme},[t._v(t._s(t.info.name))])]),n("q-avatar",{attrs:{color:t.theme,"text-color":"white"}},[t._v("\n        "+t._s(t.getTableItem(t.info.tables,t.item.clientInfo.tableId).name)+"\n      ")]),n("q-item-label",{staticClass:"q-pl-xs"},[t._v("\n        "+t._s(t.getWayItem(t.info.ways,t.item.clientInfo.way).name)+"\n      ")])],1):t._e(),n("q-item-section",[n("q-item-label",[t._v(t._s(t.dayjs(t.item.created).format("YYYY-MM-DD HH:mm")))]),n("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v("單號："+t._s(t.item.orderId))]),n("q-item-label",{attrs:{caption:""}},[t._v("\n        "+t._s(t.item.completed?"餐點完成":"製作中")+"\n        "+t._s(t.item.checked?"已付款":"尚未付款")+"\n      ")])],1),n("q-item-section",{attrs:{side:""}},[t.isAllowReOrder(t.item)?n("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"add",color:t.theme,label:"加點"},on:{click:function(e){return e.stopPropagation(),t.clickReOrder(t.item.orderId)}}}):t._e(),n("q-item-label",{staticClass:"text-bold",attrs:{lines:"1"}},[t._v("\n        金額："+t._s(t.orderInfo(t.item.items).totalPrice)+"\n      ")])],1)]},proxy:!0}])},[n("q-card",{class:"bg-grey-3"},[n("q-card-section",[n("q-list",[t._l(t.item.items,(function(e){return n("q-item",{key:e.id},[n("q-item-section",{staticClass:"q-ml-none",attrs:{top:"",thumbnail:""}},[n("img",{attrs:{src:e.product.img}})]),n("q-item-section",[n("q-item-label",[t._v("\n              "+t._s(e.product.name)+"\n            ")]),n("q-item-label",{attrs:{caption:""}},[t._v("\n              "+t._s(t.getSubItemInfo(e))+"\n            ")])],1),n("q-item-section",{attrs:{side:"",center:""}},[n("q-item-label",{attrs:{caption:""}},[t._v("$"+t._s(e.product.price)+"x"+t._s(e.qty))]),n("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.getItemPrice(e)))])],1)],1)})),n("q-separator")],2)],1),n("q-card-section",[n("q-item-section",{attrs:{side:"",top:""}},[n("q-item-label",{attrs:{caption:""}},[n("q-checkbox",{attrs:{val:t.item.id,color:t.theme,label:"已完成"},on:{input:function(e){return t.changeHandler(t.item)}},model:{value:t.item.completed,callback:function(e){t.$set(t.item,"completed",e)},expression:"item.completed"}}),n("q-checkbox",{attrs:{val:t.item.id,color:t.theme,label:"已付款"},on:{input:function(e){return t.changeHandler(t.item)}},model:{value:t.item.checked,callback:function(e){t.$set(t.item,"checked",e)},expression:"item.checked"}})],1)],1)],1)],1)],1)},d=[],u=n("5a0c"),h=n.n(u),m=n("a3a5"),p={name:"HistoryItem",extends:o["a"],props:{item:{type:Object,default:null}},data(){return{info:null}},computed:r()({},Object(c["b"])(["shop","branch","theme","theme"])),async created(){this.info=await this.getShopInfo(this.item.shop,this.item.branch)},watch:{},methods:{dayjs:h.a,orderInfo:m["e"],getWayItem:m["d"],getTableItem:m["c"],getItemPrice:m["a"],getSubItemInfo:m["b"],isAllowReOrder(t){const e=h()(t.created).format("YYYY-MM-DD"),n=h()(new Date).format("YYYY-MM-DD"),a=!t.checked&&e===n&&t.shop===this.shop&&t.branch===this.branch;return a},clickReOrder(t){this.dispatch("SetOrderId",t);const e=`/${this.shop}/${this.branch}/menu`;this.to(e)},async getShopInfo(t,e){const n=await this.dispatch("GetShopInfo",{shop:t,branch:e});return n},changeHandler(t){this.dispatch("UpdateHistoryOrderStatus",t)}}},f=p,b=n("2877"),g=n("3b73"),v=n("4074"),q=n("0170"),y=n("cb32"),_=n("9c40"),O=n("f09f"),I=n("a370"),$=n("1c1c"),k=n("66e5"),w=n("eb85"),D=n("8f8e"),x=n("eebe"),j=n.n(x),E=Object(b["a"])(f,l,d,!1,null,null,null),M=E.exports;j()(E,"components",{QExpansionItem:g["a"],QItemSection:v["a"],QItemLabel:q["a"],QAvatar:y["a"],QBtn:_["a"],QCard:O["a"],QCardSection:I["a"],QList:$["a"],QItem:k["a"],QSeparator:w["a"],QCheckbox:D["a"]});var S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("q-btn",{attrs:{round:"",color:t.theme,icon:"delete_forever"},on:{click:t.confirm}})],1)},C=[],Q={name:"CleanBtn",extends:o["a"],data(){return{}},computed:r()({},Object(c["b"])(["shop","branch","theme"])),async created(){},methods:{confirm(){this.$q.dialog({title:"確認清除",message:"確認清除所有訂單資料?",cancel:!0,persistent:!0}).onOk((()=>{this.dispatch("ResstHistoryOrder")})).onCancel((()=>{})).onDismiss((()=>{}))}}},H=Q,Y=Object(b["a"])(H,S,C,!1,null,null,null),P=Y.exports;j()(Y,"components",{QBtn:_["a"]});var R={name:"HistoryPage",extends:o["a"],components:{historyItem:M,cleanBtn:P},data(){return{orders:[]}},computed:r()({},Object(c["b"])(["shop","branch","theme","shopInfo","historyOrders"])),watch:{historyOrders(t){this.updateOrders()}},async created(){console.log("historyOrders=="),console.log(this.orders),this.updateOrders()},methods:{updateOrders(){this.orders=this.historyOrders}}},A=R,B=n("2c91"),L=n("de5e"),N=Object(b["a"])(A,a,s,!1,null,null,null);e["default"]=N.exports;j()(N,"components",{QList:$["a"],QItem:k["a"],QSpace:B["a"],QPageSticky:L["a"]})},efea:function(t,e,n){"use strict";n("ddb0"),n("e6cf");var a=n("2b0e");let s=null;null===s&&(s=new a["a"]({data(){return{classNames:[]}},methods:{on(t,e,n){if(Object.defineProperty(n,"fnName",{value:e}),void 0===this._events[t])this.$on(t,n);else{let a=!1;for(let s=0;s<this._events[t].length;s++)if(this._events[t][s].fnName===e){a=!0,this._events[t][s]=n;break}a||this.$on(t,n)}},emit(t,...e){this.$emit(t,...e)},off(t,e){this.$off(t)}}}));var i,r,o=s,c=n("71f5"),l=n("7b12"),d=n("2ef0"),u=n.n(d),h={name:"VComponent",data(){return{}},computed:{params(){return this.$route.params},uid(){return`uid_${this._uid}`},id(){let t=void 0===this.$el||void 0===this.$el.getAttribute?null:this.$el.getAttribute("id");return void 0!==this.$attrs&&this.$attrs.id&&(t=this.$attrs.id),t},query(){return this.$route.query}},methods:{addModalHandler(t=null){this.on("Modal.DispatchData",((e,n,a=null)=>{null!==a&&a!==this.id||(null===t?this.modalHandler(e,n):t(e,n))}))},modalHandler(t,e,n=null){},showModal(t,e=null,n=null,a=!1){null!==e&&this.setModalData(e),this.emit("Modal.CMD.Show",t,!0,n,a)},setModalData(t){Object(c["d"])("modalData",t,"tmp")},haveModalData(){return null!==Object(c["b"])("modalData","tmp")},getModalData(){const t=u.a.cloneDeep(Object(c["b"])("modalData","tmp"));return Object(c["c"])("modalData","tmp"),t},hideModal(t){this.emit("Modal.CMD.Show",t,!1)},on(t,...e){let n,a;const s=t.split(",");1===e.length?(n=e[0],a=this.id):2===e.length&&(a=e[0],n=e[1]);for(let i=0;i<s.length;i++)o.on(s[i],a,n)},emit(t,...e){o.emit(t,...e)},off(t,e){o.off(t,e)},async fetch(t,...e){const n=Object(l["b"])();return new Promise(((a,s)=>{n[t](...e).then((t=>{a(t)})).catch((t=>{s(t)}))}))},fetchSync(t,...e){const n=Object(l["b"])(),a=e.pop();n[t](...e).then((t=>{a(null,t)})).catch((t=>{a(t,t)}))},async fetchURL(t,e="GET",n=null){return new Promise(((a,s)=>{Object(l["a"])(t,e,n).then((t=>{a(t)})).catch((t=>{s(t)}))}))},async dispatch(t,...e){return new Promise(((n,a)=>{const s=1===e.length?e[0]:e;this.$store.dispatch(t,s).then((t=>{n(t)})).catch((t=>{a(t)}))}))},to(t){this.$router.push(t)},setReactive(t,e){this[t]=Object.assign({},e,e)},trace(t){console.log(t)},alert(t,e="",n=null){this.$q.dialog({title:e,message:t}).onOk((()=>{null!==n&&n()})).onCancel((()=>{})).onDismiss((()=>{}))},confirm(t,e="",n=null){this.$q.dialog({title:e,message:t,cancel:!0,persistent:!0}).onOk((()=>{null!==n&&n()})).onOk((()=>{})).onCancel((()=>{})).onDismiss((()=>{}))}}},m=h,p=n("2877"),f=Object(p["a"])(m,i,r,!1,null,null,null);e["a"]=f.exports}}]);